<app-loader *ngIf="isLoading"></app-loader>
<div *ngIf="!isLoading" class="material-container">
    <div class="details">
        <h1 class="main-title">{{data.materialName}}</h1>
        <div class="author">
            <span>Created by: </span>
            <strong>{{data.createdBy}}</strong>
        </div>
        <div class="rating" *ngIf="data.noOfRatings && isRating()">
            {{data.averageRating | number:'1.1-2'}}
            <div class="stars">
                <span class="empty">
                    <svg xmlns="http://www.w3.org/2000/svg" width="80px" height="16px" viewBox="-2.5 0 125 24"
                        fill="currentColor">
                        <path
                            d="M20 9.74L12.81 9.12L10 2.5L7.19 9.13L0 9.74L5.46 14.47L3.82 21.5L10 17.77L16.18 21.5L14.55 14.47L20 9.74ZM10 15.9L6.24 18.17L7.24 13.89L3.92 11.01L8.3 10.63L10 6.6L11.71 10.64L16.09 11.02L12.77 13.9L13.77 18.18L10 15.9Z" />
                        <path
                            d="M45 9.74L37.81 9.12L35 2.5L32.19 9.13L25 9.74L30.46 14.47L28.82 21.5L35 17.77L41.18 21.5L39.55 14.47L45 9.74ZM35 15.9L31.24 18.17L32.24 13.89L28.92 11.01L33.3 10.63L35 6.6L36.71 10.64L41.09 11.02L37.77 13.9L38.77 18.18L35 15.9Z" />
                        <path
                            d="M70 9.74L62.81 9.12L60 2.5L57.19 9.13L50 9.74L55.46 14.47L53.82 21.5L60 17.77L66.18 21.5L64.55 14.47L70 9.74ZM60 15.9L56.24 18.17L57.24 13.89L53.92 11.01L58.3 10.63L60 6.6L61.71 10.64L66.09 11.02L62.77 13.9L63.77 18.18L60 15.9Z" />
                        <path
                            d="M95 9.74L87.81 9.12L85 2.5L82.19 9.13L75 9.74L80.46 14.47L78.82 21.5L85 17.77L91.18 21.5L89.55 14.47L95 9.74ZM85 15.9L81.24 18.17L82.24 13.89L78.92 11.01L83.3 10.63L85 6.6L86.71 10.64L91.09 11.02L87.77 13.9L88.77 18.18L85 15.9Z" />
                        <path
                            d="M120 9.74L112.81 9.12L110 2.5L107.19 9.13L100 9.74L105.46 14.47L103.82 21.5L110 17.77L116.18 21.5L114.55 14.47L120 9.74ZM110 15.9L106.24 18.17L107.24 13.89L103.92 11.01L108.3 10.63L110 6.6L111.71 10.64L116.09 11.02L112.77 13.9L113.77 18.18L110 15.9Z" />
                    </svg>
                </span>
                <span class="filled" [style.width]="+data.averageRating * 20 + '%'">
                    <svg xmlns="http://www.w3.org/2000/svg" width="80px" height="16px" viewBox="-2.5 0 125 24"
                        fill="currentColor">
                        <path
                            d="M110 17.77L116.18 21.5L114.54 14.47L120 9.74L112.81 9.13L110 2.5L107.19 9.13L100 9.74L105.46 14.47L103.82 21.5L110 17.77Z" />
                        <path
                            d="M85 17.77L91.18 21.5L89.54 14.47L95 9.74L87.81 9.13L85 2.5L82.19 9.13L75 9.74L80.46 14.47L78.82 21.5L85 17.77Z" />
                        <path
                            d="M60 17.77L66.18 21.5L64.54 14.47L70 9.74L62.81 9.13L60 2.5L57.19 9.13L50 9.74L55.46 14.47L53.82 21.5L60 17.77Z" />
                        <path
                            d="M35 17.77L41.18 21.5L39.54 14.47L45 9.74L37.81 9.13L35 2.5L32.19 9.13L25 9.74L30.46 14.47L28.82 21.5L35 17.77Z" />
                        <path
                            d="M10 17.77L16.18 21.5L14.54 14.47L20 9.74L12.81 9.13L10 2.5L7.19 9.13L0 9.74L5.46 14.47L3.82 21.5L10 17.77Z" />
                    </svg>
                </span>
            </div>
            ({{data.noOfRatings}})
        </div>
        <div *ngIf="!data.noOfRatings || !isRating()" class="rating">No ratings yet</div>
        <div class="download-count">
            <span>Number of downloads: </span>
            <strong>{{data.noOfDownloads}}</strong>
        </div>
        <div class="last-updated">
            <span>Last updated on: </span>
            <strong>{{data.lastUpdatedOn | date:'dd MMMM, yyyy'}}</strong>
        </div>
        <div class="btn-wrapper">
            <button class="share-btn" (click)="handleShareClick()">
                <span>Share</span>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"
                    fill="currentColor">
                    <path
                        d="M23.25 10.75L14.5 2v5C5.75 8.25 2 14.5.75 20.75c3.125-4.375 7.5-6.375 13.75-6.375V19.5l8.75-8.75z">
                    </path>
                </svg>
            </button>
            <button class="report-btn" (click)="handleReportClick()">
                <span>Report Issue</span>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"
                    fill="currentColor">
                    <path d="M0 0h24v24H0z" fill="none" />
                    <path d="M14.4 6L14 4H5v17h2v-7h5.6l.4 2h7V6z" />
                </svg>
            </button>
            <button *ngIf="data.type === 'FREE' || isPurchased" class="rating-btn" (click)="openRatingPopup()">
                <span>Give Rating</span>
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px"
                    fill="currentColor">
                    <path d="M0 0h24v24H0V0z" fill="none" />
                    <path
                        d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z" />
                </svg>
            </button>
        </div>
    </div>
    <div class="material-detail-card">
        <div class="thumbnail">
            <svg enable-background="new 0 0 512 512" height="100" viewBox="0 0 512 512" width="100"
                xmlns="http://www.w3.org/2000/svg">
                <g>
                    <path
                        d="m82.581 330.323h-16.517c-22.804 0-41.29-18.486-41.29-41.29 0-13.682 11.092-24.774 24.774-24.774h33.032v66.064z"
                        fill="#bd4150" />
                    <path d="m396.387 0h-305.548l-8.506 16.516v487.484h388.377l16.516-8.516v-404.645z" fill="#eceaec" />
                    <path
                        d="m90.839 470.71v-470.71c-9.121 0-16.516 7.394-16.516 16.516v478.968c0 9.122 7.395 16.516 16.516 16.516h379.871c9.121 0 16.516-7.395 16.516-16.516h-371.613c-13.683 0-24.774-11.092-24.774-24.774z"
                        fill="#dad8db" />
                    <path
                        d="m487.226 89.421c0-4.38-1.74-8.581-4.838-11.679l-72.908-72.905c-3.097-3.097-7.298-4.837-11.678-4.837h-1.415v82.581c0 4.56 3.697 8.258 8.258 8.258h82.581z"
                        fill="#dad8db" />
                    <path
                        d="m305.548 313.807h-256c-2.896 0-5.677-.497-8.261-1.411l-7.954 13.271v104.333c0 13.683 11.092 24.774 24.774 24.774h247.441l16.516-8.839v-115.612c0-9.122-7.394-16.516-16.516-16.516z"
                        fill="#e15f78" />
                    <path
                        d="m41.29 312.396c-9.6-3.413-16.516-12.592-16.516-23.364v148.645c0 13.682 11.092 24.774 24.774 24.774h256c9.121 0 16.516-7.395 16.516-16.516h-256c-13.682 0-24.774-11.092-24.774-24.774z"
                        fill="#db4655" />
                    <g fill="#fff">
                        <path
                            d="m260.452 379.25h-16.21v-15.653h18.323c4.565 0 8.258-3.698 8.258-8.258s-3.694-8.258-8.258-8.258h-26.581c-4.565 0-8.258 3.698-8.258 8.258v65.581c0 4.56 3.694 8.258 8.258 8.258s8.258-3.698 8.258-8.258v-25.153h16.21c4.565 0 8.258-3.698 8.258-8.258s-3.694-8.259-8.258-8.259z" />
                        <path
                            d="m108.992 346.839h-18.395c-2.194 0-4.298.875-5.847 2.427-1.541 1.549-2.406 3.647-2.406 5.831h-.006v66.065c0 4.56 3.694 8.258 8.258 8.258s8.258-3.698 8.258-8.258v-20.482c3.705-.02 7.778-.038 10.137-.038 15.032 0 27.266-12.069 27.266-26.899.001-14.836-12.233-26.904-27.265-26.904zm0 37.286c-2.339 0-6.371.016-10.056.036-.016-3.81-.056-20.806-.056-20.806h10.113c5.831 0 10.75 4.758 10.75 10.387s-4.92 10.383-10.751 10.383z" />
                        <path
                            d="m178.242 347.815h-18.153c-2.194 0-4.298.871-5.847 2.423-1.548 1.552-2.419 3.657-2.411 5.851l.048 31.968c0 8.915.081 32.157.081 32.157.008 2.19.887 4.29 2.444 5.835 1.54 1.532 3.637 2.395 5.815 2.395h.032s13.46-.052 18.669-.141c19.395-.343 33.476-17.238 33.476-40.173-.001-24.114-13.727-40.315-34.154-40.315zm.387 63.971c-2.363.04-6.452.077-10.177.097-.024-7.56-.056-18.375-.056-23.827l-.032-23.726h9.879c16.79 0 17.637 19.823 17.637 23.798-.001 11.626-5.332 23.449-17.251 23.658z" />
                    </g>
                    <path
                        d="m197.935 279.363c-6.371 0-12.129-3.315-16.177-9.569-6.016-9.282-4.435-19.794 4.331-28.843 8.839-9.129 26.927-17.718 48.694-24.73 6.79-12.798 13.702-27.778 20.161-44.339 3.815-9.786 6.895-18.609 9.363-26.5-10.879-19.944-17.347-38.512-15.629-50.569 1.75-12.234 10.887-19.121 24.468-18.371 4.032.218 13.653 2.323 15.976 17.137 1.774 11.327-1.21 29.637-7.194 50.444 11.323 19.101 26.847 39.56 42.032 55.262 22.952-1.399 42.403.274 52.185 6.177 7.661 4.621 10.669 12.157 8.048 20.153-4.29 13.069-14.653 19.056-27.75 16.004-11.024-2.573-24.685-12.198-38.54-25.56-22.282 1.96-48.508 6.496-71.516 13.262-13.734 24.649-28.581 43.839-41.048 48.605-2.516.965-5 1.437-7.404 1.437zm-2.322-18.544c1.379 2.121 2.137 2.077 2.492 2.036 5.258-.536 14.016-9.613 24.016-24.956-6.613 2.835-12.54 5.907-17.524 9.206-12.5 8.278-9.847 12.367-8.984 13.714zm145.484-45.851c7.056 5.516 13.613 9.286 19.097 10.569 4.282.996 6.484.488 8.306-5.065-2.435-3.694-12.798-5.468-27.403-5.504zm-65.589-50.92c-5.379 15.315-11.96 31.173-19.145 46.036 15.476-3.887 31.79-6.948 47.371-8.891-10.073-11.415-19.807-24.237-28.226-37.145zm-3.976-71.427c-5.863 0-6.169 2.198-6.508 4.52-.863 6.101 1.282 14.778 5.516 24.782 3.734-17.827 2.976-27.258 1.161-29.302-.056 0-.112 0-.169 0z"
                        fill="#e15f78" />
                </g>
            </svg>
        </div>
        <div *ngIf="+data.price && !isPurchased" class="price">Price: {{data.price | currency:'INR':'symbol':'1.0-0'}}
        </div>
        <div *ngIf="!+data.price" class="price">Free</div>
        <span *ngIf="isPurchased" class="status">Purchased for {{data.price | currency:'INR':'symbol':'1.0-0'}}</span>
        <button class="buy-btn" (click)="openConfirmPopup()" [ngClass]="{'loading-btn':btnLoading}"
            [disabled]="btnLoading">{{data.type === 'FREE' || isPurchased ? 'Download' : 'Buy Now'}}</button>
    </div>
    <div class="material-body">
        <div class="description">
            <h4 class="title">Description:</h4>
            <p class="desc-text">{{data.description}}</p>
        </div>
        <div class="for-whom">
            <h4 class="title">Who this tuition is for:</h4>
            <p class="for-whom-text">{{data.forWhom}}</p>
        </div>
    </div>
    <div *ngIf="userReviews.length" class="ratings-reviews">
        <h4 class="title">Ratings & Reviews</h4>
        <div *ngFor="let review of userReviews" class="review-container">
            <div class="review-top">
                <div class="avatar">{{getInitials(review.ratedBy)}}</div>
                <div class="review-details">
                    <div class="name">{{review.ratedBy}}</div>
                    <div class="rating">
                        <span class="empty">
                            <svg xmlns="http://www.w3.org/2000/svg" width="80px" height="16px" viewBox="-2.5 0 125 24"
                                fill="currentColor">
                                <path
                                    d="M20 9.74L12.81 9.12L10 2.5L7.19 9.13L0 9.74L5.46 14.47L3.82 21.5L10 17.77L16.18 21.5L14.55 14.47L20 9.74ZM10 15.9L6.24 18.17L7.24 13.89L3.92 11.01L8.3 10.63L10 6.6L11.71 10.64L16.09 11.02L12.77 13.9L13.77 18.18L10 15.9Z" />
                                <path
                                    d="M45 9.74L37.81 9.12L35 2.5L32.19 9.13L25 9.74L30.46 14.47L28.82 21.5L35 17.77L41.18 21.5L39.55 14.47L45 9.74ZM35 15.9L31.24 18.17L32.24 13.89L28.92 11.01L33.3 10.63L35 6.6L36.71 10.64L41.09 11.02L37.77 13.9L38.77 18.18L35 15.9Z" />
                                <path
                                    d="M70 9.74L62.81 9.12L60 2.5L57.19 9.13L50 9.74L55.46 14.47L53.82 21.5L60 17.77L66.18 21.5L64.55 14.47L70 9.74ZM60 15.9L56.24 18.17L57.24 13.89L53.92 11.01L58.3 10.63L60 6.6L61.71 10.64L66.09 11.02L62.77 13.9L63.77 18.18L60 15.9Z" />
                                <path
                                    d="M95 9.74L87.81 9.12L85 2.5L82.19 9.13L75 9.74L80.46 14.47L78.82 21.5L85 17.77L91.18 21.5L89.55 14.47L95 9.74ZM85 15.9L81.24 18.17L82.24 13.89L78.92 11.01L83.3 10.63L85 6.6L86.71 10.64L91.09 11.02L87.77 13.9L88.77 18.18L85 15.9Z" />
                                <path
                                    d="M120 9.74L112.81 9.12L110 2.5L107.19 9.13L100 9.74L105.46 14.47L103.82 21.5L110 17.77L116.18 21.5L114.55 14.47L120 9.74ZM110 15.9L106.24 18.17L107.24 13.89L103.92 11.01L108.3 10.63L110 6.6L111.71 10.64L116.09 11.02L112.77 13.9L113.77 18.18L110 15.9Z" />
                            </svg>
                        </span>
                        <span class="filled" [style.width]="+review.rating * 20 + '%'">
                            <svg xmlns="http://www.w3.org/2000/svg" width="80px" height="16px" viewBox="-2.5 0 125 24"
                                fill="currentColor">
                                <path
                                    d="M110 17.77L116.18 21.5L114.54 14.47L120 9.74L112.81 9.13L110 2.5L107.19 9.13L100 9.74L105.46 14.47L103.82 21.5L110 17.77Z" />
                                <path
                                    d="M85 17.77L91.18 21.5L89.54 14.47L95 9.74L87.81 9.13L85 2.5L82.19 9.13L75 9.74L80.46 14.47L78.82 21.5L85 17.77Z" />
                                <path
                                    d="M60 17.77L66.18 21.5L64.54 14.47L70 9.74L62.81 9.13L60 2.5L57.19 9.13L50 9.74L55.46 14.47L53.82 21.5L60 17.77Z" />
                                <path
                                    d="M35 17.77L41.18 21.5L39.54 14.47L45 9.74L37.81 9.13L35 2.5L32.19 9.13L25 9.74L30.46 14.47L28.82 21.5L35 17.77Z" />
                                <path
                                    d="M10 17.77L16.18 21.5L14.54 14.47L20 9.74L12.81 9.13L10 2.5L7.19 9.13L0 9.74L5.46 14.47L3.82 21.5L10 17.77Z" />
                            </svg>
                        </span>
                    </div>
                </div>
            </div>
            <div class="review-bottom">
                <div class="comment">{{review.comment}}</div>
                <div class="date-time">{{review.ratedOn | date:'h:mm a, dd MMMM, yyyy'}}</div>
            </div>
        </div>
    </div>
</div>
<app-popup *ngIf="buyPopup" (onConfirm)="downloadMaterial()" (closePopup)="closePopup()"></app-popup>
<app-share *ngIf="sharePopup" [title]="data.materialName" [url]="data.url" (closePopup)="closePopup()">
</app-share>
<app-report *ngIf="reportPopup" (issueSubmit)="reportMaterial($event)" (closePopup)="closePopup()"></app-report>
<app-rating *ngIf="ratingPopup" (onSubmitRating)="feedbackMaterial($event)" (closePopup)="closePopup()"></app-rating>